<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TaiLovesyouu</title>
<meta name="author" content="TaiLovesyou2026">
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
:root{
  --accent:#8b5cf6; --bg1:#0b0b14; --bg2:#050508; --glass:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.18); --blur:18px; --radius:20px;
}
*{box-sizing:border-box;font-family:Inter,system-ui;margin:0;padding:0;}
body{min-height:100vh;background:radial-gradient(circle at top,var(--bg1),var(--bg2));color:white;font-size:14px;}
body::after{content:"TaiLovesyou2026";position:fixed;bottom:10px;right:14px;opacity:.15;font-size:12px;pointer-events:none;}
.glass{background:var(--glass);backdrop-filter:blur(var(--blur));border:1px solid var(--border);border-radius:var(--radius);box-shadow:0 0 30px rgba(0,0,0,.6);padding:10px;margin-bottom:10px;transition:all .3s;}
header{margin:10px;padding:10px;}
nav{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;}
nav button{padding:10px 16px;border-radius:30px;border:none;background:rgba(255,255,255,.1);color:white;cursor:pointer;transition:.25s;font-weight:600;}
nav button:hover{background:var(--accent);transform:scale(1.05);}
main{padding:10px;}
.page{display:none;}
.page.active{display:block;animation:fade .25s ease;}
@keyframes fade{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:none;}}
#notesGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;}
.note{padding:8px;display:flex;flex-direction:column;border-radius:15px;transition:.3s;}
.note textarea{width:100%;height:120px;background:transparent;border:none;outline:none;color:white;resize:none;font-size:14px;border-radius:10px;}
.note input,.note select{margin:2px 0;padding:6px;border-radius:8px;border:none;background:rgba(255,255,255,.08);color:white;}
#chatBox{max-height:250px;overflow-y:auto;margin-bottom:5px;}
.chatMsg{font-size:13px;margin-bottom:6px;opacity:.9;}
#onlineUsers{margin-top:5px;}
.userItem{display:flex;align-items:center;gap:6px;margin-bottom:2px;}
.userItem img{width:22px;height:22px;border-radius:50%;object-fit:cover;}
input[type=range]{width:100%;}
@media(max-width:600px){nav{flex-direction:column;}#notesGrid{grid-template-columns:1fr;}}
</style>
</head>
<body>

<!-- SITE ACCESS -->
<div id="gate" class="glass" style="max-width:400px;margin:15vh auto;">
<h2>ðŸ’œ TaiLovesyouu</h2>
<input id="siteAccess" type="password" placeholder="Enter site access">
<button onclick="enterGate()">Enter</button>
</div>

<!-- AUTH -->
<div id="auth" class="glass" style="max-width:400px;margin:15vh auto;display:none;">
<h3>Login / Register</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<input id="username" placeholder="Username (register)">
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="app" style="display:none">
<header class="glass">
<h2>TaiLovesyouu</h2>
<nav>
<button onclick="go('notes')">Notes</button>
<button onclick="go('chat')">Chat</button>
<button onclick="go('settings')">Settings</button>
<button onclick="go('profile')">Profile</button>
<button onclick="go('pro')" id="proBtn">Pro</button>
<button onclick="go('staff')" id="staffBtn">Staff</button>
<button onclick="toggleRainbow()">ðŸŒˆ Rainbow</button>
</nav>
</header>

<main>
<section id="notes" class="page glass">
<h3>Notes</h3>
<button onclick="addNote()">+ New Note</button>
<div id="notesGrid"></div>
</section>

<section id="chat" class="page glass">
<h3>Chat</h3>
<div id="chatBox"></div>
<input id="chatInput" placeholder="Message" onkeydown="sendChat(event)">
<h4>Online Users</h4>
<div id="onlineUsers"></div>
</section>

<section id="settings" class="page glass">
<h3>Settings</h3>
<label>Accent</label><input type="color" onchange="set('--accent',this.value)">
<label>Glass Blur</label><input type="range" min="5" max="40" oninput="set('--blur',this.value+'px')">
<label>Border Radius</label><input type="range" min="10" max="40" oninput="set('--radius',this.value+'px')">
<label>Background Gradient</label><input type="text" placeholder="e.g. #8b5cf6,#f43f5e" id="bgGradInput">
<button onclick="setGradient()">Apply Gradient</button>
<hr>
<h4>Unlock Role</h4>
<input id="rolePass" type="password" placeholder="Access password">
<button onclick="unlockRole()">Unlock</button>
</section>

<section id="profile" class="page glass">
<h3>Profile</h3>
<p>Username: <b id="pName"></b></p>
<p>Role: <b id="pRole"></b></p>
<label>Upload PFP:</label><input type="file" id="pfpInput" onchange="uploadPFP(event)">
<img id="pfpPreview" src="" alt="Profile picture" style="width:60px;height:60px;border-radius:50%;margin-top:5px;">
</section>

<section id="pro" class="page glass">
<h3>Pro Tools</h3>
<p>Advanced note templates, gradients, animations enabled.</p>
</section>

<section id="staff" class="page glass">
<h3>Staff Panel</h3>
<h4>All Users</h4>
<div id="allUsers"></div>
</section>

</main>
</div>

<script>
// ================= CONFIG =================
const SITE_ACCESS_PASSWORD="tailovesyou";
const PRO_ACCESS_PASSWORD="taiwantshuzz";
const STAFF_ACCESS_PASSWORD="cuhlove";

const supabase = supabase.createClient(
  "https://briwvcsduzssmjipxupb.supabase.co",
  "sb_publishable_KXEckjdTYLzecNnacueLaA_JU8dUceV"
);

let user=null, profile=null, role="user", notes=[], chatSub, rainbowMode=false;

// ================= SITE GATE =================
function enterGate(){
  if(siteAccess.value!==SITE_ACCESS_PASSWORD)return alert("Access Denied");
  gate.style.display="none"; auth.style.display="block";
}

// ================= AUTH =================
async function register(){
  const {data,error}=await supabase.auth.signUp({email:email.value,password:password.value});
  if(error)return alert(error.message);
  await supabase.from("profiles").insert({id:data.user.id,username:username.value,role:"user"});
  alert("Registered. Login now.");
}
async function login(){
  const {data,error}=await supabase.auth.signInWithPassword({email:email.value,password:password.value});
  if(error)return alert(error.message);
  user=data.user; await loadProfile(); auth.style.display="none"; app.style.display="block"; go("notes"); loadNotes(); loadChat(); loadOnlineUsers();
}

// ================= PROFILE =================
async function loadProfile(){
  const {data}=await supabase.from("profiles").select("*").eq("id",user.id).single();
  profile=data; role=data.role;
  pName.textContent=data.username; pRole.textContent=role;
  proBtn.style.display=role!=="user"?"":"none"; staffBtn.style.display=role==="staff"?"":"none";
}

// ================= PFP =================
async function uploadPFP(e){
  const file=e.target.files[0]; if(!file) return;
  await supabase.storage.from("pfps").upload(user.id+".png",file,{upsert:true});
  pfpPreview.src=URL.createObjectURL(file);
}

// ================= NOTES =================
async function loadNotes(){
  const {data}=await supabase.from("notes").select("*").eq("user_id",user.id);
  notes=data||[]; renderNotes();
}
function renderNotes(){
  notesGrid.innerHTML="";
  notes.forEach(n=>{
    const d=document.createElement("div"); d.className="note glass";
    const t=document.createElement("textarea"); t.value=n.content||"";
    t.oninput=()=>supabase.from("notes").update({content:t.value}).eq("id",n.id);
    const font=document.createElement("input"); font.value=n.font||"Inter"; font.placeholder="Font"; font.onchange=()=>supabase.from("notes").update({font:font.value}).eq("id",n.id);
    const size=document.createElement("input"); size.type="number"; size.value=n.size||14; size.onchange=()=>supabase.from("notes").update({size:+size.value}).eq("id",n.id);
    const color=document.createElement("input"); color.type="color"; color.value=n.color||"#ffffff"; color.onchange=()=>supabase.from("notes").update({color:color.value}).eq("id",n.id);
    d.appendChild(t); d.appendChild(font); d.appendChild(size); d.appendChild(color);
    notesGrid.appendChild(d);
  });
}
async function addNote(){
  const {data}=await supabase.from("notes").insert({user_id:user.id,content:""}).select().single();
  notes.push(data); renderNotes();
}

// ================= CHAT =================
async function loadChat(){
  const {data}=await supabase.from("messages").select("*").order("created_at",{ascending:true});
  chatBox.innerHTML=""; data.forEach(m=>displayChat(m));
  chatSub = supabase.channel('public:messages').on('postgres_changes',{event:'INSERT',schema:'public',table:'messages'},payload=>displayChat(payload.new)).subscribe();
}
function displayChat(m){
  const div=document.createElement("div"); div.className="chatMsg"; div.textContent=`${m.user_id}: ${m.message}`;
  chatBox.appendChild(div); chatBox.scrollTop=chatBox.scrollHeight;
}
async function sendChat(e){
  if(e.key!=="Enter"||!chatInput.value)return;
  await supabase.from("messages").insert({user_id:user.id,message:chatInput.value});
  chatInput.value="";
}

// ================= ONLINE USERS =================
async function loadOnlineUsers(){
  setInterval(async()=>{
    const {data}=await supabase.from("profiles").select("*");
    const now=new Date();
    onlineUsers.innerHTML=""; allUsers.innerHTML="";
    data.forEach(u=>{
      const last=new Date(u.last_active); 
      const online=(now-last)/1000<180;
      const div=document.createElement("div"); div.className="userItem";
      const img=document.createElement("img"); img.src=`https://ui-avatars.com/api/?name=${u.username}&background=8b5cf6&color=fff`;
      div.appendChild(img); div.appendChild(document.createTextNode(`${u.username} (${u.role}) ${online?'ðŸŸ¢':'âšª'}`));
      if(online)onlineUsers.appendChild(div);
      allUsers.appendChild(div.cloneNode(true));
    });
    if(user)await supabase.from("profiles").update({last_active:new Date()}).eq("id",user.id);
  },15000);
}

// ================= ROLE UNLOCK =================
async function unlockRole(){
  const p=rolePass.value; let newRole=null;
  if(p===PRO_ACCESS_PASSWORD)newRole="pro";
  if(p===STAFF_ACCESS_PASSWORD)newRole="staff";
  if(!newRole)return alert("Invalid");
  await supabase.from("profiles").update({role:newRole}).eq("id",user.id);
  await loadProfile(); alert("Unlocked");
}

// ================= SPA =================
function go(id){document.querySelectorAll(".page").forEach(p=>p.classList.remove("active")); document.getElementById(id).classList.add("active");}
function set(v,val){document.documentElement.style.setProperty(v,val);}
function toggleRainbow(){rainbowMode=!rainbowMode; if(rainbowMode)cycleRainbow();}

function cycleRainbow(){
  if(!rainbowMode)return;
  let hue=Math.floor(Math.random()*360);
  set('--accent',`hsl(${hue},100%,50%)`);
  setTimeout(cycleRainbow,500);
}

function setGradient(){
  const val=document.getElementById("bgGradInput").value.split(",");
  if(val.length>=2)document.body.style.background=`linear-gradient(45deg, ${val.join(",")})`;
}

setInterval(()=>user&&supabase.from("profiles").update({last_active:new Date()}).eq("id",user.id),60000);
</script>
</body>
</html>
